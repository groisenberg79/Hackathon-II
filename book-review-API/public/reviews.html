<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Post a Review</title>
</head>
<body>
<nav>
  <a href="index.html">Login</a>
  <a href="reviews.html">Reviews</a>
</nav>
    <h1>Post a Book Review</h1>

    <form id="review-form">
        <label for="title">Book Title:</label>
        <input type="text" id="title" required><br>

        <label for="author">Author:</label>
        <input type="text" id="author" required><br>

        <label for="rating">Rating (1-5):</label>
        <input type="number" id="rating" min="1" max="5" required><br>

        <label for="content">Review:</label><br>
        <textarea id="content" rows="5" cols="30" required></textarea><br>

        <button type="submit">Submit Review</button>
    </form>

    <div id="review-message"></div>

    <hr>

    <h2>View Reviews by Book</h2>
    <form id="book-review-search-form">
        <label for="search-title">Book Title:</label>
        <input type="text" id="search-title" required><br>

        <label for="search-author">Author:</label>
        <input type="text" id="search-author" required><br>

        <button type="submit">Search Reviews</button>
    </form>

    <div id="book-reviews-results"></div>

    <hr>

    <h2>View Reviews by User</h2>
    <form id="user-review-search-form">
        <label for="search-username">Username:</label>
        <input type="text" id="search-username" required><br>

        <button type="submit">Search User Reviews</button>
    </form>

    <div id="user-reviews-results"></div>

    <script src="main.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const bookReviewSearchForm = document.getElementById("book-review-search-form");
            if (bookReviewSearchForm) {
                console.log("üéØ Book review form found");
                bookReviewSearchForm.addEventListener("submit", async function (e) {
                    e.preventDefault();
                    console.log("üìö Book review search form submitted");

                    const title = document.getElementById("search-title").value;
                    const author = document.getElementById("search-author").value;

                    try {
                        const res = await fetch("/reviews/book", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({ title, author })
                        });

                        const data = await res.json();
                        const container = document.getElementById("book-reviews-results");
                        container.innerHTML = "";

                        if (res.ok && data.length > 0) {
                            data.forEach(review => {
                                const div = document.createElement("div");
                                div.innerHTML = `
                                    <hr>
                                    <p><strong>Rating:</strong> ${review.rating}</p>
                                    <p><strong>Review:</strong> ${review.review_text}</p>
                                    <p><em>Posted on:</em> ${new Date(review.created_at).toLocaleString()}</p>
                                `;
                                container.appendChild(div);
                            });
                        } else {
                            container.textContent = "No reviews found for this book.";
                        }
                    } catch (error) {
                        document.getElementById("book-reviews-results").textContent = "Error fetching reviews.";
                    }
                });
            } else {
                console.log("‚ùå Book review form NOT found");
            }
        });
    </script>
</body>
</html>
